<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema de Asignación de Salones</title>
    <base target="_top">
    <?!= include('Estilos.html'); ?>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Sistema de Asignación de Salones</h1>
            <div class="d-flex align-items-center">
                <span id="userInfo" class="me-3"></span>
                <button id="logoutBtn" class="btn btn-outline-light">Cerrar Sesión</button>
            </div>
        </div>

        <div class="section">
            <h2>Edificios y Aulas</h2>
            <div class="row">
                <div class="col-md-4">
                    <div class="building-card" id="buildingD">
                        <h3>Edificio D</h3>
                        <p>24 aulas</p>
                        <div class="accordion" id="accordionD">
                            <!-- Los pisos se generarán dinámicamente -->
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="building-card" id="buildingE">
                        <h3>Edificio E</h3>
                        <p>23 aulas</p>
                        <div class="accordion" id="accordionE">
                            <!-- Los pisos se generarán dinámicamente -->
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="building-card" id="buildingF">
                        <h3>Edificio F</h3>
                        <p>16 aulas</p>
                        <div class="accordion" id="accordionF">
                            <!-- Los pisos se generarán dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Nueva sección para subir archivo CSV -->
        <div class="section">
            <h2>Cargar archivo CSV para método Radix</h2>
            <div class="mb-3">
                <input class="form-control" type="file" id="csvFile" accept=".csv">
            </div>
            <button id="processCsvBtn" class="btn btn-primary">Procesar archivo CSV</button>
        </div>

        <!-- Sección de Opciones Avanzadas (reemplaza a "Inicializar Sistema") -->
        <div class="section">
            <h2>Opciones Avanzadas</h2>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="advancedOptionsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    Opciones Avanzadas
                </button>
                <ul class="dropdown-menu" aria-labelledby="advancedOptionsDropdown">
                    <li><a class="dropdown-item" href="#" id="reassignDisabled">Reasignar grupos con discapacidad a primeros pisos</a></li>
                    <li><a class="dropdown-item" href="#" id="reassignChronicallyIll">Reasignar grupos con enfermedades crónicas</a></li>
                    <li><a class="dropdown-item" href="#" id="reassignPregnant">Reasignar grupos embarazadas (opcional)</a></li>
                </ul>
            </div>
        </div>

        <!-- Sección de Administración (solo visible para administradores) -->
        <div id="adminSection" class="section" style="display: none;">
            <h2>Administración</h2>
            <ul class="nav nav-tabs" id="adminTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">Usuarios</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="permissions-tab" data-bs-toggle="tab" data-bs-target="#permissions" type="button" role="tab">Permisos</button>
                </li>
            </ul>
            <div class="tab-content" id="adminTabsContent">
                <div class="tab-pane fade show active" id="users" role="tabpanel">
                    <h3>Agregar Usuario</h3>
                    <form id="userForm">
                        <div class="row">
                            <div class="col-md-4"><input type="text" class="form-control" id="userName" placeholder="Nombre" required></div>
                            <div class="col-md-4"><input type="email" class="form-control" id="userEmail" placeholder="Correo Electrónico" required></div>
                            <div class="col-md-4"><input type="password" class="form-control" id="userPassword" placeholder="Contraseña" required></div>
                        </div>
                        <div class="mt-2">
                            <select class="form-control" id="userRole" required>
                                <option value="">Seleccionar Rol</option>
                                <option value="admin">Administrador</option>
                                <option value="editor">Editor</option>
                                <option value="viewer">Visualizador</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success mt-2">Agregar Usuario</button>
                    </form>
                    <h3 class="mt-4">Lista de Usuarios</h3>
                    <div class="table-responsive">
                        <table class="table" id="usersTable">
                            <thead><tr><th>Nombre</th><th>Correo Electrónico</th><th>Rol</th><th>Activo</th><th>Acciones</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="tab-pane fade" id="permissions" role="tabpanel">
                    <h3>Asignar Permisos</h3>
                    <form id="permissionForm">
                        <div class="row">
                            <div class="col-md-4"><select class="form-control" id="permissionUser" required><option value="">Seleccionar Usuario</option></select></div>
                            <div class="col-md-4">
                                <select class="form-control" id="permissionModule" required>
                                    <option value="">Seleccionar Módulo</option>
                                    <option value="aulas">Aulas</option>
                                    <option value="cursos">Cursos</option>
                                    <option value="profesores">Profesores</option>
                                    <option value="asignaciones">Asignaciones</option>
                                    <option value="grupos">Grupos</option>
                                    <option value="materias">Materias</option>
                                    <option value="usuarios">Usuarios</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select class="form-control" id="permissionLevel" required>
                                    <option value="">Seleccionar Nivel</option>
                                    <option value="lectura">Lectura</option>
                                    <option value="escritura">Escritura</option>
                                    <option value="administrador">Administrador</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success mt-2">Asignar Permiso</button>
                    </form>
                    <h3 class="mt-4">Lista de Permisos</h3>
                    <div class="table-responsive">
                        <table class="table" id="permissionsTable">
                            <thead><tr><th>Usuario</th><th>Módulo</th><th>Nivel de Acceso</th><th>Acciones</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let aulas = [];
        let cursos = [];
        let profesores = [];
        let asignaciones = [];
        let usuarios = [];
        let permisos = [];
        let grupos = [];
        let materias = [];
        let horarios = [];
        let currentUser = null;
        let sessionId = null;

        // Configuración de edificios
        const buildingConfig = {
            'D': { pisos: [6, 6, 6, 6] }, // 24 aulas
            'E': { pisos: [6, 6, 6, 5] }, // 23 aulas
            'F': { pisos: [4, 4, 4, 4] }  // 16 aulas
        };

        // Función para inicializar el dashboard
        function initializeDashboardEvents() {
            // Obtener ID de sesión de sessionStorage
            sessionId = sessionStorage.getItem('sessionId');
            
            if (!sessionId) {
                // Si no hay sesión, redirigir al login
                redirectToLogin();
                return;
            }
            
            // Verificar sesión y obtener usuario actual
            google.script.run
                .withSuccessHandler(function(user) {
                    if (!user) {
                        // Si no hay usuario, redirigir al login
                        redirectToLogin();
                        return;
                    }
                    
                    currentUser = user;
                    const userInfoElement = document.getElementById('userInfo');
                    if (userInfoElement) {
                        userInfoElement.textContent = `Bienvenido, ${user.email} (${user.role})`;
                    }
                    
                    // Configurar event listeners primero
                    configurarEventListeners();
                    
                    // Cargar datos iniciales
                    cargarDatos();
                    
                    // Mostrar u ocultar sección de administración según rol
                    if (user.role === 'admin') {
                        const adminSection = document.getElementById('adminSection');
                        if (adminSection) {
                            adminSection.style.display = 'block';
                        }
                        cargarDatosAdministracion();
                    }
                })
                .getCurrentUser(sessionId);
        }

        // Función para redirigir al login
        function redirectToLogin() {
            // Limpiar cualquier sesión residual
            sessionStorage.removeItem('sessionId');
            
            // Mostrar indicador de carga
            document.body.innerHTML = '<div class="loading-container"><div class="spinner"></div><p>Redirigiendo al login...</p></div>';
            
            // Recargar la página completa para limpiar todo el estado
            window.location.reload();
        }

        // Función para mostrar mensajes
        function mostrarMensaje(mensaje, tipo) {
            // Crear elemento de mensaje
            const messageElement = document.createElement('div');
            messageElement.className = `alert alert-${tipo === 'error' ? 'danger' : tipo === 'info' ? 'info' : 'success'} alert-dismissible fade show`;
            messageElement.setAttribute('role', 'alert');
            messageElement.innerHTML = `
                ${mensaje}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            // Insertar al principio del contenedor principal
            const container = document.querySelector('.container');
            if (container) {
                container.insertBefore(messageElement, container.firstChild);
            } else {
                // Si no hay contenedor, insertar en el body
                document.body.insertBefore(messageElement, document.body.firstChild);
            }
            
            // Auto-eliminar después de 5 segundos
            setTimeout(() => {
                if (messageElement && messageElement.parentNode) {
                    messageElement.remove();
                }
            }, 5000);
        }

        // Función para cargar datos iniciales
        function cargarDatos() {
            // Mostrar indicador de carga
            const container = document.querySelector('.container');
            if (container) {
                const loadingDiv = document.createElement('div');
                loadingDiv.id = 'loadingIndicator';
                loadingDiv.innerHTML = '<div class="spinner"></div><p>Cargando datos...</p>';
                container.insertBefore(loadingDiv, container.firstChild);
            }
            
            google.script.run
                .withSuccessHandler(function(data) {
                    aulas = data.aulas || [];
                    cursos = data.cursos || [];
                    profesores = data.profesores || [];
                    asignaciones = data.asignaciones || [];
                    usuarios = data.usuarios || [];
                    permisos = data.permisos || [];
                    grupos = data.grupos || [];
                    materias = data.materias || [];
                    horarios = data.horarios || [];
                    
                    // Eliminar indicador de carga
                    const loadingIndicator = document.getElementById('loadingIndicator');
                    if (loadingIndicator) {
                        loadingIndicator.remove();
                    }
                    
                    // Si no hay aulas, inicializar el sistema
                    if (aulas.length <= 1) { // Solo encabezado
                        google.script.run
                            .withSuccessHandler(function(result) {
                                if (result.success) {
                                    cargarDatos(); // Recargar datos después de inicializar
                                } else {
                                    mostrarMensaje('Error al inicializar el sistema: ' + result.message, 'error');
                                }
                            })
                            .withFailureHandler(function(error) {
                                mostrarMensaje('Error al inicializar el sistema: ' + error.message, 'error');
                            })
                            .initializeSheets();
                        return;
                    }
                    
                    // Actualizar interfaz
                    actualizarInterfaz();
                })
                .withFailureHandler(function(error) {
                    mostrarMensaje('Error al cargar datos: ' + error.message, 'error');
                    
                    // Eliminar indicador de carga
                    const loadingIndicator = document.getElementById('loadingIndicator');
                    if (loadingIndicator) {
                        loadingIndicator.remove();
                    }
                })
                .getAllData();
        }

        // Función para actualizar la interfaz
        function actualizarInterfaz() {
            // Actualizar tarjetas de edificios
            actualizarTarjetasEdificios();
        }

        // Función para actualizar las tarjetas de edificios
        function actualizarTarjetasEdificios() {
            const edificios = ['D', 'E', 'F'];
            
            edificios.forEach(edificio => {
                const accordionId = `accordion${edificio}`;
                const accordion = document.getElementById(accordionId);
                
                if (!accordion) return;
                
                // Limpiar contenido existente
                accordion.innerHTML = '';
                
                // Obtener pisos del edificio
                const pisos = buildingConfig[edificio].pisos;
                
                // Crear un accordion item para cada piso
                pisos.forEach((aulasPiso, indicePiso) => {
                    const piso = indicePiso + 1;
                    const collapseId = `collapse${edificio}${piso}`;
                    const classroomsId = `classrooms${edificio}${piso}`;
                    
                    // Crear accordion item
                    const accordionItem = document.createElement('div');
                    accordionItem.className = 'accordion-item';
                    
                    accordionItem.innerHTML = `
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${collapseId}" aria-expanded="false" aria-controls="${collapseId}">
                                Piso ${piso}
                            </button>
                        </h2>
                        <div id="${collapseId}" class="accordion-collapse collapse" data-bs-parent="#${accordionId}">
                            <div class="accordion-body classroom-grid" id="${classroomsId}">
                                <!-- Las aulas se agregarán dinámicamente -->
                            </div>
                        </div>
                    `;
                    
                    accordion.appendChild(accordionItem);
                    
                    // Agregar aulas al piso
                    const classroomsContainer = document.getElementById(classroomsId);
                    const aulasPisoActual = aulas.filter(aula => 
                        aula[1] === edificio && aula[2] === piso
                    );
                    
                    aulasPisoActual.forEach(aula => {
                        const classroomBox = document.createElement('div');
                        classroomBox.className = 'classroom-box';
                        
                        // Añadir icono según tipo de aula
                        let icono = '';
                        if (aula[7] === 'Accesible') {
                            icono = '<i class="fas fa-wheelchair"></i> ';
                        } else if (aula[7] === 'Laboratorio') {
                            icono = '<i class="fas fa-flask"></i> ';
                        }
                        
                        classroomBox.innerHTML = `${icono}${aula[3]}`;
                        classroomsContainer.appendChild(classroomBox);
                    });
                });
            });
        }

        // Función para configurar los event listeners
        function configurarEventListeners() {
            // Configurar el botón de cerrar sesión - Usar addEventListener directamente
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    event.stopPropagation();
                    
                    if (confirm('¿Está seguro de que desea cerrar su sesión actual?')) {
                        // Mostrar mensaje de carga
                        mostrarMensaje('Cerrando sesión, espere un momento...', 'info');
                        
                        const currentSessionId = sessionStorage.getItem('sessionId');
                        
                        // Llamar a la función de logout del servidor
                        google.script.run
                            .withSuccessHandler(function(result) {
                                // Limpiar sessionStorage
                                sessionStorage.removeItem('sessionId');
                                
                                // Mostrar mensaje de éxito
                                mostrarMensaje('Sesión cerrada correctamente. Redirigiendo...', 'success');
                                
                                // Redirigir al login después de un momento
                                setTimeout(function() {
                                    redirectToLogin();
                                }, 1500);
                            })
                            .withFailureHandler(function(error) {
                                console.error('Error al cerrar sesión:', error);
                                
                                // Incluso si hay error, limpiamos la sesión y redirigimos
                                sessionStorage.removeItem('sessionId');
                                mostrarMensaje('Error al cerrar sesión en el servidor, pero se ha cerrado la sesión local. Redirigiendo...', 'warning');
                                
                                // Forzar una redirección completa
                                setTimeout(function() {
                                    redirectToLogin();
                                }, 1500);
                            })
                            .logout(currentSessionId);
                    }
                });
            }
            
            // Event listeners para opciones avanzadas
            const reassignDisabledBtn = document.getElementById('reassignDisabled');
            if (reassignDisabledBtn) {
                reassignDisabledBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    google.script.run
                        .withSuccessHandler(function(result) {
                            if (result.success) {
                                mostrarMensaje('Grupos con discapacidad reasignados correctamente', 'success');
                                cargarDatos();
                            } else {
                                mostrarMensaje(result.message, 'error');
                            }
                        })
                        .withFailureHandler(function(error) {
                            mostrarMensaje('Error al reasignar grupos: ' + error.message, 'error');
                        })
                        .reassignDisabledGroups(sessionId);
                });
            }
            
            const reassignChronicallyIllBtn = document.getElementById('reassignChronicallyIll');
            if (reassignChronicallyIllBtn) {
                reassignChronicallyIllBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    google.script.run
                        .withSuccessHandler(function(result) {
                            if (result.success) {
                                mostrarMensaje('Grupos con enfermedades crónicas reasignados correctamente', 'success');
                                cargarDatos();
                            } else {
                                mostrarMensaje(result.message, 'error');
                            }
                        })
                        .withFailureHandler(function(error) {
                            mostrarMensaje('Error al reasignar grupos: ' + error.message, 'error');
                        })
                        .reassignChronicallyIllGroups(sessionId);
                });
            }
            
            const reassignPregnantBtn = document.getElementById('reassignPregnant');
            if (reassignPregnantBtn) {
                reassignPregnantBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    google.script.run
                        .withSuccessHandler(function(result) {
                            if (result.success) {
                                mostrarMensaje('Grupos embarazadas reasignados correctamente', 'success');
                                cargarDatos();
                            } else {
                                mostrarMensaje(result.message, 'error');
                            }
                        })
                        .withFailureHandler(function(error) {
                            mostrarMensaje('Error al reasignar grupos: ' + error.message, 'error');
                        })
                        .reassignPregnantGroups(sessionId);
                });
            }
            
            // Event listener para procesar archivo CSV
            const processCsvBtn = document.getElementById('processCsvBtn');
            if (processCsvBtn) {
                processCsvBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    const fileInput = document.getElementById('csvFile');
                    if (fileInput.files.length === 0) {
                        mostrarMensaje('Por favor, seleccione un archivo CSV', 'error');
                        return;
                    }
                    
                    const file = fileInput.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const csvData = e.target.result;
                        google.script.run
                            .withSuccessHandler(function(result) {
                                if (result.success) {
                                    mostrarMensaje('Archivo CSV procesado correctamente', 'success');
                                    cargarDatos();
                                } else {
                                    mostrarMensaje(result.message, 'error');
                                }
                            })
                            .withFailureHandler(function(error) {
                                mostrarMensaje('Error al procesar archivo CSV: ' + error.message, 'error');
                            })
                            .processCsvData(sessionId, csvData);
                    };
                    
                    reader.readAsText(file);
                });
            }
        }

        // Función para cargar datos de administración
        function cargarDatosAdministracion() {
            // Cargar usuarios
            google.script.run
                .withSuccessHandler(function(users) {
                    const usersTable = document.getElementById('usersTable');
                    if (!usersTable) return;
                    
                    const tbody = usersTable.querySelector('tbody');
                    if (!tbody) return;
                    
                    tbody.innerHTML = '';
                    
                    // Saltar encabezado
                    for (let i = 1; i < users.length; i++) {
                        const user = users[i];
                        const activeText = user[5] ? 'Sí' : 'No';
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${user[1]}</td>
                            <td>${user[2]}</td>
                            <td>${user[4]}</td>
                            <td>${activeText}</td>
                            <td>
                                <button class="btn btn-warning btn-sm" onclick="toggleUserStatus('${user[0]}', ${user[5]})">
                                    ${user[5] ? 'Desactivar' : 'Activar'}
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="resetPassword('${user[0]}')">Resetear Contraseña</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    }
                    
                    // Actualizar el select de usuarios en el formulario de permisos
                    const permissionUserSelect = document.getElementById('permissionUser');
                    if (permissionUserSelect) {
                        permissionUserSelect.innerHTML = '<option value="">Seleccionar Usuario</option>';
                        
                        // Saltar encabezado
                        for (let i = 1; i < users.length; i++) {
                            const user = users[i];
                            permissionUserSelect.innerHTML += `<option value="${user[0]}">${user[1]} (${user[2]})</option>`;
                        }
                    }
                })
                .getUsuarios();
            
            // Cargar permisos
            google.script.run
                .withSuccessHandler(function(permissions) {
                    const permissionsTable = document.getElementById('permissionsTable');
                    if (!permissionsTable) return;
                    
                    const tbody = permissionsTable.querySelector('tbody');
                    if (!tbody) return;
                    
                    tbody.innerHTML = '';
                    
                    // Saltar encabezado
                    for (let i = 1; i < permissions.length; i++) {
                        const permission = permissions[i];
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${permission[1]}</td>
                            <td>${permission[2]}</td>
                            <td>${permission[3]}</td>
                            <td>
                                <button class="btn btn-danger btn-sm" onclick="deletePermission('${permission[0]}')">Eliminar</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    }
                })
                .getPermissions();
            
            // Configurar event listeners para administración
            configurarEventListenersAdministracion();
        }

        // Función para configurar event listeners de administración
        function configurarEventListenersAdministracion() {
            // Formulario de agregar usuario
            const userForm = document.getElementById('userForm');
            if (userForm) {
                userForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const nombre = document.getElementById('userName').value;
                    const email = document.getElementById('userEmail').value;
                    const password = document.getElementById('userPassword').value;
                    const role = document.getElementById('userRole').value;
                    
                    google.script.run
                        .withSuccessHandler(function(response) {
                            if (response.success) {
                                mostrarMensaje('Usuario creado exitosamente', 'success');
                                userForm.reset();
                                cargarDatosAdministracion();
                            } else {
                                mostrarMensaje(response.message, 'error');
                            }
                        })
                        .withFailureHandler(function(error) {
                            mostrarMensaje('Error al crear usuario: ' + error.message, 'error');
                        })
                        .addUsuario(sessionId, nombre, email, password, role);
                });
            }
            
            // Formulario de asignar permisos
            const permissionForm = document.getElementById('permissionForm');
            if (permissionForm) {
                permissionForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const userId = document.getElementById('permissionUser').value;
                    const module = document.getElementById('permissionModule').value;
                    const level = document.getElementById('permissionLevel').value;
                    
                    google.script.run
                        .withSuccessHandler(function(response) {
                            if (response.success) {
                                mostrarMensaje('Permiso asignado exitosamente', 'success');
                                permissionForm.reset();
                                cargarDatosAdministracion();
                            } else {
                                mostrarMensaje(response.message, 'error');
                            }
                        })
                        .withFailureHandler(function(error) {
                            mostrarMensaje('Error al asignar permiso: ' + error.message, 'error');
                        })
                        .addPermission(sessionId, userId, module, level);
                });
            }
        }

        // Función para cambiar el estado de un usuario
        function toggleUserStatus(userId, currentStatus) {
            google.script.run
                .withSuccessHandler(function(response) {
                    if (response.success) {
                        cargarDatosAdministracion();
                    } else {
                        mostrarMensaje(response.message, 'error');
                    }
                })
                .withFailureHandler(function(error) {
                    mostrarMensaje('Error al cambiar estado de usuario: ' + error.message, 'error');
                })
                .toggleUserStatus(sessionId, userId, !currentStatus);
        }

        // Función para resetear contraseña
        function resetPassword(userId) {
            const newPassword = prompt('Ingresa la nueva contraseña:');
            
            if (newPassword) {
                google.script.run
                    .withSuccessHandler(function(response) {
                        if (response.success) {
                            mostrarMensaje('Contraseña reseteada exitosamente', 'success');
                        } else {
                            mostrarMensaje(response.message, 'error');
                        }
                    })
                    .withFailureHandler(function(error) {
                        mostrarMensaje('Error al resetear contraseña: ' + error.message, 'error');
                    })
                    .resetPassword(sessionId, userId, newPassword);
            }
        }

        // Función para eliminar un permiso
        function deletePermission(permissionId) {
            if (confirm('¿Estás seguro de eliminar este permiso?')) {
                google.script.run
                    .withSuccessHandler(function(response) {
                        if (response.success) {
                            cargarDatosAdministracion();
                        } else {
                            mostrarMensaje(response.message, 'error');
                        }
                    })
                    .withFailureHandler(function(error) {
                        mostrarMensaje('Error al eliminar permiso: ' + error.message, 'error');
                    })
                    .deletePermission(sessionId, permissionId);
            }
        }

        // Inicializar el dashboard cuando se carga la página
        document.addEventListener('DOMContentLoaded', initializeDashboardEvents);
    </script>
</body>
</html>


