<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestón de Edificios Escolares</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Estilos principales -->
  <style>
    /* ============================================
          VARIABLES CSS - SISTEMA COMPLETO
       ============================================ */
    :root {
      /* Paleta Principal */
      --negro: #121212;
      --negro-claro: #1E1E1E;
      --verde-oscuro: #2E7D32;
      --verde-medio: #4CAF50;
      --verde-claro: #81C784;
      --amarillo-oscuro: #F57F17;
      --amarillo-medio: #FFC107;
      --amarillo-claro: #FFE082;
      --gris-claro: #E0E0E0;
      --gris-texto: #BDBDBD;
      --disponible: #4CAF50;
      --ocupado: #FFC107;
      --accesible: #FF9800;

      /* Paleta Login */
      --negro-login: #000000;
      --verde-oscuro-login: #006633;
      --oro-dorado: #D4AF37;
      --blanco: #FFFFFF;
    }

    /*
      ============================================
          ESTILOS GLOBALES Y RESET
      ============================================
      */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--negro) 0%, var(--verde-oscuro) 100%);
      min-height: 100vh;
      color: var(--blanco);
      overflow-x: hidden;
    }

    /*
      ============================================
          LAYOUT DE LA APLICACIÓN
      ============================================
      */
    #app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .app-loader {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }

    .app-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .loader {
      border: 5px solid var(--negro-claro);
      border-top: 5px solid var(--verde-medio);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .loading-text {
      color: var(--gris-claro);
      font-size: 18px;
    }

    .error-container {
      text-align: center;
      padding: 40px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 10px;
      margin: 20px;
    }

    /*
      ============================================
          ESTILOS PARA EL LOGIN
      ============================================
      */
    .login-wrapper {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .login-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.7);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }

    .uabc-logo {
      height: 60px;
      width: auto;
    }

    .institution-info {
      display: flex;
      flex-direction: column;
    }

    .university-name {
      font-size: 18px;
      font-weight: 600;
      color: var(--blanco);
      margin-bottom: 5px;
    }

    .faculty-name {
      font-size: 14px;
      color: var(--oro-dorado);
    }

    .system-title {
      text-align: center;
      font-size: 22px;
      font-weight: 700;
      color: var(--blanco);
      text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
    }

    .login-main-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .login-container {
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 15px;
      padding: 40px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(212, 175, 55, 0.3);
      position: relative;
      overflow: hidden;
    }

    .login-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--verde-oscuro-login), var(--oro-dorado));
    }

    .form-title {
      text-align: center;
      color: var(--blanco);
      margin-bottom: 30px;
      font-size: 28px;
      font-weight: 600;
      text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--oro-dorado);
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid rgba(212, 175, 55, 0.3);
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s;
      background-color: rgba(0, 0, 0, 0.5);
      color: var(--blanco);
    }

    .form-group input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .form-group input:focus {
      border-color: var(--oro-dorado);
      outline: none;
      background-color: rgba(0, 0, 0, 0.7);
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
    }

    .login-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(90deg, var(--verde-oscuro-login), var(--negro-login));
      color: var(--blanco);
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }

    .login-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, var(--negro-login), var(--oro-dorado));
      z-index: -1;
      transition: opacity 0.3s;
      opacity: 0;
    }

    .login-btn:hover::before {
      opacity: 1;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
    }

    .login-help {
      margin-top: 20px;
      text-align: center;
    }

    .login-help p {
      color: var(--gris-texto);
      font-size: 14px;
      font-style: italic;
    }

    .login-footer {
      background-color: rgba(0, 0, 0, 0.7);
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .credits {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      color: var(--oro-dorado);
      font-weight: 500;
    }

    .credits-text {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .lide-logo {
      height: 40px;
      width: auto;
    }

    .lide-description {
      font-size: 12px;
      color: var(--blanco);
      font-style: italic;
    }

    /*
      ============================================
          ESTILOS PARA LA PÁGINA PRINCIPAL
      ============================================
      */
    .principal-wrapper {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .principal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
      background-color: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .menu-toggle {
      background: none;
      border: none;
      color: var(--gris-claro);
      font-size: 24px;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
      transition: all 0.3s;
      display: block;
    }

    .menu-toggle:hover {
      color: var(--verde-claro);
      background-color: rgba(76, 175, 80, 0.1);
    }

    .header-logos {
      display: flex;
      align-items: center;
    }

    .logo-uabc-fca {
      height: 50px;
      width: auto;
    }

    .header-info {
      display: flex;
      flex-direction: column;
    }

    .system-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--blanco);
    }

    .faculty-name {
      font-size: 12px;
      color: var(--gris-texto);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--verde-medio);
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      color: white;
      font-size: 18px;
    }

    .logout-btn {
      padding: 8px 16px;
      background: rgba(79, 209, 197, 0.3);
      border: 1px solid var(--verde-medio);
      border-radius: 5px;
      color: var(--gris-claro);
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .logout-btn:hover {
      background: var(--verde-medio);
      color: white;
    }

    .main-layout {
      flex: 1;
      display: flex;
      position: relative;
    }

    /* Sidebar */
    .sidebar {
      width: 250px;
      background-color: rgba(30, 30, 30, 0.95);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
      position: fixed;
      height: 100vh;
      z-index: 1000;
      left: 0;
      top: 0;
    }

    .sidebar-header {
      padding: 25px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .sidebar-logo {
      width: 120px;
      height: auto;
    }

    .sidebar-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--verde-claro);
      text-align: center;
    }

    .sidebar-nav {
      flex: 1;
      padding: 20px 0;
      overflow-y: auto;
    }

    .sidebar-link {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      color: var(--gris-texto);
      text-decoration: none;
      transition: all 0.3s;
      border-left: 4px solid transparent;
      cursor: pointer;
    }

    .sidebar-link:hover {
      background-color: rgba(76, 175, 80, 0.1);
      color: var(--gris-claro);
      border-left-color: var(--verde-medio);
    }

    .sidebar-link.active {
      background-color: rgba(76, 175, 80, 0.2);
      color: var(--verde-claro);
      border-left-color: var(--verde-medio);
    }

    .sidebar-link i {
      width: 24px;
      font-size: 18px;
      margin-right: 15px;
    }

    .sidebar-link span {
      font-size: 16px;
      font-weight: 500;
    }

    .sidebar-footer {
      padding: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: center;
    }

    /* Overlay */
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      display: none;
    }

    /* Contenido principal */
    .main-content {
      flex: 1;
      margin-left: 250px;
      padding: 30px;
      max-width: calc(100% - 250px);
      transition: all 0.3s ease;
    }

    /* Estado colapsado del sidebar */
    .sidebar-collapsed .sidebar {
      left: -250px;
    }

    .sidebar-collapsed .main-content {
      margin-left: 0;
      max-width: 100%;
    }

    #content-section {
      min-height: 400px;
    }

    /* Contenido de secciones */
    .welcome-section {
      text-align: center;
      margin-bottom: 40px;
    }

    .welcome-title {
      font-size: 32px;
      font-weight: 500;
      margin-bottom: 10px;
      color: var(--gris-claro);
      text-shadow: 0 0 10px rgba(3, 169, 244, 0.3);
    }

    .welcome-subtitle {
      font-size: 16px;
      color: var(--gris-texto);
      max-width: 600px;
      margin: 0 auto;
    }

    .section-header {
      margin-bottom: 30px;
    }

    .section-header h1 {
      font-size: 28px;
      color: var(--verde-claro);
      margin-bottom: 10px;
    }

    .section-header p {
      color: var(--gris-texto);
    }

    /* Dashboard */
    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .dashboard-card {
      background-color: rgba(30, 30, 30, 0.7);
      border-radius: 12px;
      padding: 25px;
      display: flex;
      align-items: center;
      gap: 20px;
      transition: all 0.3s;
      border: 1px solid rgba(79, 209, 197, 0.2);
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .card-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--verde-oscuro), var(--verde-medio));
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
    }

    .card-content h3 {
      font-size: 24px;
      margin-bottom: 5px;
      color: var(--verde-claro);
    }

    .card-content p {
      color: var(--gris-texto);
      font-size: 14px;
    }

    /* Controles */
    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .search-bar {
      display: flex;
      gap: 10px;
      flex: 1;
      min-width: 250px;
    }

    .search-bar input {
      flex: 1;
      padding: 10px 15px;
      border: 1px solid var(--gris-texto);
      border-radius: 5px;
      background-color: var(--negro-claro);
      color: var(--gris-claro);
      font-size: 14px;
    }

    .search-bar button {
      padding: 10px 20px;
      background: var(--verde-medio);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .search-bar button:hover {
      background: var(--verde-claro);
    }

    .filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 8px 16px;
      background: rgba(255, 193, 7, 0.2);
      border: 1px solid var(--amarillo-medio);
      border-radius: 5px;
      color: var(--amarillo-medio);
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .filter-btn:hover,
    .filter-btn.active {
      background: var(--amarillo-medio);
      color: var(--negro);
    }

    /* Edificios - CORREGIDO */
    .buildings-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      width: 100%;
    }

    .loading-buildings {
      grid-column: 1 / -1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      gap: 15px;
      color: var(--gris-texto);
    }

    .building-card {
      background-color: rgba(30, 30, 30, 0.7);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(79, 209, 197, 0.2);
      transition: all 0.3s ease;
      width: 100%;
      display: flex;
      flex-direction: column;
    }

    .building-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .building-icon {
      width: 45px;
      height: 45px;
      background-color: var(--verde-medio);
      border-radius: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      font-weight: bold;
      color: white;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .building-info h3 {
      font-size: 20px;
      font-weight: 500;
      color: var(--verde-claro);
      margin-bottom: 3px;
    }

    .building-info p {
      color: var(--gris-texto);
      font-size: 13px;
    }

    .floor-toggle {
      width: 100%;
      padding: 12px;
      background: linear-gradient(90deg, var(--verde-oscuro), var(--verde-medio));
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      transition: all 0.3s;
    }

    .floor-toggle:hover {
      background: linear-gradient(90deg, var(--verde-medio), var(--verde-claro));
      transform: translateY(-2px);
    }

    .floor-toggle i {
      margin-left: auto;
      transition: transform 0.3s;
    }

    .floor-toggle.active i {
      transform: rotate(180deg);
    }

    .salon-grid {
      display: flex;
      flex-wrap: nowrap;
      gap: 10px;
      margin-top: 10px;
      max-height: 0;
      overflow-x: auto;
      overflow-y: hidden;
      transition: all 0.5s ease;
      padding-bottom: 5px;
    }

    .salon-grid.active {
      max-height: 500px;
    }

    .salon-card {
      flex: 0 0 auto;
      width: 120px;
      background-color: var(--negro-claro);
      border: 2px solid var(--verde-medio);
      border-radius: 6px;
      padding: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
      transition: all 0.3s;
      cursor: pointer;
      min-height: 60px;
      font-size: 14px;
    }

    .salon-card:hover {
      transform: scale(1.05) rotate(1deg);
    }

    .salon-card.disponible {
      border-color: var(--disponible);
      background-color: rgba(76, 175, 80, 0.1);
    }

    .salon-card.ocupado {
      border-color: var(--ocupado);
      background-color: rgba(255, 193, 7, 0.1);
    }

    .salon-card.accesible {
      border-color: var(--accesible);
    }

    /* Gestión de Usuarios */
    .users-controls {
      margin-bottom: 20px;
    }

    .btn-primary {
      padding: 10px 20px;
      background: var(--verde-medio);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .btn-primary:hover {
      background: var(--verde-claro);
    }

    .btn-secondary {
      padding: 10px 20px;
      background: transparent;
      color: var(--gris-claro);
      border: 1px solid var(--gris-texto);
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .users-list-container {
      background: rgba(30, 30, 30, 0.7);
      border-radius: 10px;
      padding: 20px;
      overflow-x: auto;
      /* Añadido scroll vertical */
      overflow-y: auto;
      /* Altura máxima para activar el scroll */
      max-height: 500px;
    }

    .users-table {
      width: 100%;
      border-collapse: collapse;
    }

    .users-table th {
      background-color: var(--negro);
      color: var(--verde-claro);
      padding: 12px;
      text-align: left;
      border-bottom: 2px solid var(--verde-medio);
      /* Hacer que las cabeceras sean pegajosas */
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .users-table td {
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .status-active {
      color: var(--disponible);
      font-weight: 600;
    }

    .status-inactive {
      color: #f44336;
      font-weight: 600;
    }

    .user-actions {
      display: flex;
      gap: 5px;
    }

    .btn-small {
      padding: 5px 10px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s;
    }

    .btn-edit {
      background-color: var(--amarillo-medio);
      color: var(--negro);
    }

    .btn-reset {
      background-color: var(--verde-medio);
      color: white;
    }

    .btn-deactivate {
      background-color: #f44336;
      color: white;
    }

    .btn-activate {
      background-color: var(--verde-claro);
      color: white;
    }

    /* Configuración */
    .settings-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .settings-card {
      background: rgba(30, 30, 30, 0.7);
      border-radius: 10px;
      padding: 20px;
      border: 1px solid rgba(79, 209, 197, 0.2);
    }

    .settings-card h3 {
      color: var(--verde-claro);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .settings-info {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* Notificaciones */
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 5px;
      color: white;
      font-weight: 500;
      z-index: 1002;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease;
      max-width: 400px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .notification.show {
      opacity: 1;
      transform: translateX(0);
    }

    .notification.success {
      background-color: var(--disponible);
    }

    .notification.info {
      background-color: var(--verde-medio);
    }

    .notification.warning {
      background-color: var(--amarillo-medio);
      color: var(--negro);
    }

    .notification.error {
      background-color: #f44336;
    }

    /* Footer */
    .principal-footer {
      background-color: rgba(0, 0, 0, 0.7);
      padding: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .credits {
      display: flex;
      align-items: center;
      gap: 15px;
      color: var(--gris-texto);
      font-weight: 500;
    }

    .lide-logo-footer {
      height: 30px;
      width: auto;
    }

    .lide-text {
      font-size: 12px;
      color: var(--gris-texto);
      font-style: italic;
    }

    /*
      ============================================
          RESPONSIVE DESIGN
      ============================================
      */
    @media (max-width: 1200px) {
      .buildings-container {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }
    }

    @media (max-width: 992px) {
      .buildings-container {
        grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      }
    }

    @media (max-width: 768px) {
      .principal-header {
        padding: 10px 15px;
      }

      .header-info {
        display: none;
      }

      .sidebar {
        left: -250px;
        height: 100vh;
      }

      .sidebar.active {
        left: 0;
      }

      .main-content {
        margin-left: 0;
        max-width: 100%;
        padding: 20px;
      }

      .sidebar-overlay.active {
        display: block;
      }

      .user-info span {
        display: none;
      }

      .login-header {
        padding: 15px;
      }

      .logo-container {
        flex-direction: column;
        text-align: center;
      }

      .system-title {
        font-size: 18px;
      }

      .login-container {
        padding: 30px 20px;
      }

      .form-title {
        font-size: 24px;
      }

      .dashboard-cards {
        grid-template-columns: 1fr;
      }

      .buildings-container {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .building-card {
        padding: 15px;
      }

      .building-header {
        margin-bottom: 12px;
      }

      .building-icon {
        width: 40px;
        height: 40px;
        font-size: 18px;
      }

      .building-info h3 {
        font-size: 18px;
      }

      .building-info p {
        font-size: 12px;
      }

      .floor-toggle {
        padding: 10px;
        font-size: 13px;
      }

      .salon-card {
        width: 100px;
        min-height: 50px;
        font-size: 12px;
        padding: 8px;
      }

      .controls {
        flex-direction: column;
      }

      .search-bar {
        min-width: 100%;
      }

      .users-table {
        font-size: 12px;
      }

      .user-actions {
        flex-direction: column;
      }

      .btn-small {
        padding: 3px 6px;
        font-size: 10px;
      }
      
      /* Ajustes para el contenedor de usuarios en móviles */
      .users-list-container {
        max-height: 400px;
      }
    }

    @media (max-width: 480px) {
      .main-content {
        padding: 15px;
      }

      .building-card {
        padding: 12px;
      }

      .building-header {
        margin-bottom: 10px;
      }

      .building-icon {
        width: 35px;
        height: 35px;
        font-size: 16px;
        margin-right: 10px;
      }

      .building-info h3 {
        font-size: 16px;
      }

      .building-info p {
        font-size: 11px;
      }

      .floor-toggle {
        padding: 8px;
        font-size: 12px;
      }

      .salon-card {
        width: 85px;
        min-height: 45px;
        font-size: 11px;
        padding: 6px;
      }
    }
  </style>

  <style>
    /* Estilos adicionales específicos para la página principal */
    .action-btn {
      padding: 15px 20px;
      background: rgba(76, 175, 80, 0.2);
      border: 1px solid var(--verde-medio);
      border-radius: 8px;
      color: var(--verde-claro);
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      font-weight: 500;
    }

    .action-btn:hover {
      background: var(--verde-medio);
      color: white;
      transform: translateY(-2px);
    }

    .actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .quick-actions h2 {
      color: var(--verde-claro);
      margin-bottom: 20px;
      font-size: 24px;
    }

    /* MODALES CORREGIDOS - RESPONSIVOS SIN SCROLL */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      overflow: hidden;
    }

    .modal-content {
      background-color: rgba(30, 30, 30, 0.98);
      margin: 0 auto;
      padding: 0;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      color: var(--blanco);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(79, 209, 197, 0.3);
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(90deg, var(--verde-oscuro), var(--verde-medio));
      border-radius: 12px 12px 0 0;
    }

    .modal-title {
      color: var(--blanco);
      font-size: 20px;
      font-weight: 600;
      margin: 0;
    }

    .modal-close {
      color: var(--blanco);
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s;
    }

    .modal-close:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .modal-body {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
      max-height: calc(90vh - 80px);
    }

    .close {
      display: none; /* Ocultar el close original */
    }

    .status-badge {
      padding: 5px 10px;
      border-radius: 5px;
      font-weight: 600;
      display: inline-block;
      margin-bottom: 10px;
    }

    .status-badge.available {
      background-color: var(--disponible);
      color: white;
    }

    .status-badge.occupied {
      background-color: var(--ocupado);
      color: var(--negro);
    }

    .status-badge.accessible {
      background-color: var(--accesible);
      color: white;
    }

    .group-item {
      padding: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .group-name {
      font-weight: 600;
      color: var(--verde-claro);
    }

    .schedule {
      font-size: 14px;
      color: var(--gris-texto);
      margin-top: 5px;
    }

    /* Estilos para el modal de pisos */
    .floor-modal-title {
      color: var(--verde-claro);
      margin-bottom: 20px;
      font-size: 24px;
    }

    .salon-grid-modal {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .salon-card-modal {
      background-color: var(--negro);
      border: 2px solid var(--verde-medio);
      border-radius: 8px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
      transition: all 0.3s;
      cursor: pointer;
      min-height: 70px;
      font-size: 16px;
      position: relative;
    }

    .salon-card-modal:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .salon-card-modal.disponible {
      border-color: var(--disponible);
      background-color: rgba(76, 175, 80, 0.1);
    }

    .salon-card-modal.ocupado {
      border-color: var(--ocupado);
      background-color: rgba(255, 193, 7, 0.1);
    }

    .salon-card-modal.accesible {
      border-color: var(--accesible);
      background-color: rgba(255, 152, 0, 0.1);
    }

    /* Estilos para el modal de detalles */
    .salon-details {
      margin-top: 20px;
    }

    .groups-list {
      margin-top: 20px;
    }

    .group-schedule {
      margin-top: 5px;
      color: var(--gris-texto);
      font-size: 14px;
    }

    .schedule-table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }

    .schedule-table th {
      background-color: rgba(0, 0, 0, 0.3);
      padding: 12px;
      text-align: left;
      color: var(--verde-claro);
      border-bottom: 1px solid var(--verde-medio);
    }

    .schedule-table td {
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .schedule-table tr:hover {
      background-color: rgba(0, 0, 0, 0.2);
    }

    .time-slot {
      font-weight: bold;
      color: var(--amarillo-claro);
    }

    .current-time {
      background-color: rgba(76, 175, 80, 0.2);
      border-left: 4px solid var(--verde-medio);
    }

    /* Animación de pulso */
    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    /* --- ELIMINAR SCROLL DEL MAIN CONTAINER --- */
    .main-container {
      overflow: visible !important;
      max-height: none !important;
    }

    /* --- MEJORAS DE RESPONSIVIDAD PARA MODALES --- */
    @media (max-width: 768px) {
      .modal-content {
        width: 95%;
        max-height: 95vh;
      }

      .modal-header {
        padding: 15px;
      }

      .modal-title {
        font-size: 18px;
      }

      .modal-body {
        padding: 15px;
      }

      .salon-grid-modal {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
      }

      .salon-card-modal {
        min-height: 60px;
        font-size: 14px;
        padding: 10px;
      }

      .schedule-table {
        font-size: 12px;
      }

      .schedule-table th,
      .schedule-table td {
        padding: 8px;
      }
    }

    @media (max-width: 480px) {
      .modal-content {
        width: 98%;
        max-height: 98vh;
      }

      .modal-header {
        padding: 12px;
      }

      .modal-title {
        font-size: 16px;
      }

      .modal-body {
        padding: 12px;
      }

      .salon-grid-modal {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 8px;
      }

      .salon-card-modal {
        min-height: 50px;
        font-size: 12px;
        padding: 8px;
      }

      .schedule-table {
        font-size: 10px;
      }

      .schedule-table th,
      .schedule-table td {
        padding: 6px;
      }
    }
  </style>

  <style>
    /* Estilos personalizados para SweetAlert2 */
    .swal2-popup {
      background-color: rgba(30, 30, 30, 0.95) !important;
      border: 1px solid rgba(79, 209, 197, 0.2) !important;
      border-radius: 10px !important;
    }
    
    .swal2-title {
      color: var(--verde-claro) !important;
    }
    
    .swal2-content {
      color: var(--gris-claro) !important;
    }
    
    .swal2-label {
      color: var(--oro-dorado) !important;
      font-weight: 500 !important;
      margin-bottom: 8px !important;
      display: block !important;
    }
    
    .swal2-input, .swal2-select {
      background-color: rgba(0, 0, 0, 0.5) !important;
      border: 2px solid rgba(212, 175, 55, 0.3) !important;
      border-radius: 8px !important;
      color: var(--blanco) !important;
      padding: 12px 15px !important;
      font-size: 16px !important;
      transition: all 0.3s !important;
    }
    
    .swal2-input:focus, .swal2-select:focus {
      border-color: var(--oro-dorado) !important;
      outline: none !important;
      background-color: rgba(0, 0, 0, 0.7) !important;
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2) !important;
    }
    
    .swal2-input::placeholder {
      color: rgba(255, 255, 255, 0.6) !important;
    }
    
    .swal2-validation-message {
      background-color: rgba(244, 67, 54, 0.9) !important;
      color: white !important;
    }
    
    .swal2-confirm, .swal2-cancel {
      border-radius: 8px !important;
      font-weight: 600 !important;
      padding: 10px 20px !important;
      transition: all 0.3s !important;
    }
    
    .swal2-confirm {
      background-color: var(--verde-medio) !important;
    }
    
    .swal2-confirm:hover {
      background-color: var(--verde-claro) !important;
    }
    
    .swal2-cancel {
      background-color: transparent !important;
      color: var(--gris-claro) !important;
      border: 1px solid var(--gris-texto) !important;
    }
    
    .swal2-cancel:hover {
      background-color: rgba(255, 255, 255, 0.1) !important;
    }
    
    /* Ajustes para formularios en SweetAlert2 */
    .swal2-form-group {
      margin-bottom: 15px;
      text-align: left;
    }
    
    .swal2-form-group small {
      color: var(--gris-texto);
      font-size: 12px;
      display: block;
      margin-top: 5px;
    }
    
    /* Responsive para SweetAlert2 */
    @media (max-width: 480px) {
      .swal2-popup {
        width: 95% !important;
        max-width: 95% !important;
        margin: 10px auto !important;
      }
      
      .swal2-title {
        font-size: 18px !important;
      }
      
      .swal2-input, .swal2-select {
        font-size: 14px !important;
        padding: 10px 12px !important;
      }
      
      .swal2-confirm, .swal2-cancel {
        padding: 8px 15px !important;
        font-size: 14px !important;
      }
    }
  </style>
</head>

<body>
  <!-- Overlay para cerrar menú -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Modal para Salones del Piso -->
  <div id="floorModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="floorModalTitle">Salones del Piso</h2>
        <button class="modal-close" onclick="closeFloorModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="floorSalonsContainer" class="salon-grid-modal">
          <!-- Los salones se cargarán aquí dinámicamente -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Detalles del Salón -->
  <div id="salonModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="salonName">Nombre del Salón</h2>
        <button class="modal-close" onclick="closeSalonModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="salonStatus"></div>
        <div id="salonDetails" class="salon-details">
          <h3>Grupos Asignados</h3>
          <div id="groupsList" class="groups-list">
            <!-- Los grupos se cargarán aquí -->
          </div>

          <h3 style="margin-top: 25px;">Horario del Salón</h3>
          <table class="schedule-table" id="scheduleTable">
            <thead>
              <tr>
                <th>Hora</th>
                <th>Lunes</th>
                <th>Martes</th>
                <th>Miércoles</th>
                <th>Jueves</th>
                <th>Viernes</th>
              </tr>
            </thead>
            <tbody id="scheduleBody">
              <!-- Los horarios se cargarán aquí -->
            </tbody>
          </table>
          <div id="currentStatus"
            style="margin-top: 20px; padding: 15px; border-radius: 8px; background-color: rgba(0,0,0,0.2);">
            <h4>Estado actual:</h4>
            <p id="currentStatusText"></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Menú lateral -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <img src="https://i.postimg.cc/Znt6wPm1/logo-lide.webp" alt="Logo LIDE" class="sidebar-logo">
      <span class="sidebar-title">Sistema de Gestión</span>
    </div>

    <nav class="sidebar-nav">
      <a href="#" class="sidebar-link active" onclick="loadContent('inicio')">
        <i class="fas fa-home"></i>
        <span>Inicio</span>
      </a>
      <a href="#" class="sidebar-link" onclick="loadContent('edificios')">
        <i class="fas fa-building"></i>
        <span>Edificios</span>
      </a>
      <a href="#" class="sidebar-link" onclick="loadContent('usuarios')">
        <i class="fas fa-users"></i>
        <span>Usuarios</span>
      </a>
      <a href="#" class="sidebar-link" onclick="loadContent('configuracion')">
        <i class="fas fa-cog"></i>
        <span>Configuración</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <small style="color: var(--gris-texto);">Versión 2.0</small>
    </div>
  </aside>

  <!-- Contenido principal -->
  <div class="main-content" id="mainContent">
    <header class="principal-header"> 
      <div class="header-left">
        <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
        <div class="header-logos">
          <img src="https://i.postimg.cc/905yLP2k/logo-uabc-fca.webp" alt="Logo UABC FCA" class="logo-uabc-fca">
        </div>
      </div>
      <div class="header-right">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <span id="userName">Usuario</span>
          <button class="logout-btn" id="logoutBtn">Cerrar Sesión</button>
        </div>
      </div>
    </header>

    <main class="main-container">
      <!-- Contenido dinámico se cargará aquí -->
      <div id="content-section">
        <!-- Contenido inicial se carga aquí -->
      </div>
    </main>

    <footer class="footer">
      <div class="credits">
        <span>Desarrollado por:</span>
        <img src="https://i.postimg.cc/Znt6wPm1/logo-lide.webp" alt="Logo LIDE" class="lide-logo-footer">
      </div>
    </footer>
  </div>


  <script>
    // Verificar sesión al cargar la página
        if (!localStorage.getItem('sessionToken')) {
            window.location.href = '<?!= getBaseUrl() ?>';
        }

        // Configurar logout
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                localStorage.removeItem('sessionToken');
                localStorage.removeItem('userName');
                localStorage.removeItem('userRole');
                localStorage.removeItem('userIsAdmin');
                window.location.href = '<?!= getBaseUrl() ?>';
            });
        }

        // Datos completos de salones con horarios y GRUPOS
        const salonData = {
            "D101": {
                status: "ocupado",
                groups: [
                    { name: "Grupo 101", schedule: "Lunes 8:00 - 10:00", teacher: "Dr. García", code: "MAT101" },
                    { name: "Grupo 102", schedule: "Martes 10:00 - 12:00", teacher: "Dra. López", code: "FIS101" }
                ],
                schedule: {
                    "8:00-9:00": ["Grupo 101", "", "Grupo 101", "", "Grupo 101"],
                    "9:00-10:00": ["Grupo 101", "", "Grupo 101", "", "Grupo 101"],
                    "10:00-11:00": ["", "Grupo 102", "", "Grupo 102", ""],
                    "11:00-12:00": ["", "Grupo 102", "", "Grupo 102", ""],
                    "12:00-13:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "13:00-14:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "14:00-15:00": ["", "Grupo 103", "", "Grupo 103", ""],
                    "15:00-16:00": ["", "Grupo 103", "", "Grupo 103", ""]
                }
            },
            "D102": {
                status: "ocupado",
                groups: [
                    { name: "Grupo 201", schedule: "Martes 10:00 - 12:00", teacher: "M.Sc. Rodríguez", code: "QUI201" },
                    { name: "Grupo 202", schedule: "Jueves 14:00 - 16:00", teacher: "Ing. Martínez", code: "LAB202" }
                ],
                schedule: {
                    "8:00-9:00": ["", "Grupo 201", "", "Grupo 202", ""],
                    "9:00-10:00": ["", "Grupo 201", "", "Grupo 202", ""],
                    "10:00-11:00": ["", "Grupo 201", "", "Grupo 202", ""],
                    "11:00-12:00": ["", "Grupo 201", "", "Grupo 202", ""],
                    "12:00-13:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "13:00-14:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "14:00-15:00": ["", "", "Seminario", "", "Seminario"],
                    "15:00-16:00": ["", "", "Seminario", "", "Seminario"]
                }
            },
            "D103": {
                status: "disponible",
                groups: [],
                schedule: {
                    "8:00-9:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "9:00-10:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "10:00-11:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "11:00-12:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "12:00-13:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "13:00-14:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "14:00-15:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "15:00-16:00": ["Libre", "Libre", "Libre", "Libre", "Libre"]
                }
            },
            "D104": {
                status: "disponible",
                groups: [
                    { name: "Grupo 301", schedule: "Viernes 9:00 - 11:00", teacher: "Lic. Pérez", code: "ADM301" }
                ],
                schedule: {
                    "8:00-9:00": ["Libre", "Libre", "Libre", "Libre", ""],
                    "9:00-10:00": ["Libre", "Libre", "Libre", "Libre", "Grupo 301"],
                    "10:00-11:00": ["Libre", "Libre", "Libre", "Libre", "Grupo 301"],
                    "11:00-12:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "12:00-13:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "13:00-14:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "14:00-15:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "15:00-16:00": ["Libre", "Libre", "Libre", "Libre", "Libre"]
                }
            },
            "E101": {
                status: "ocupado",
                groups: [
                    { name: "Grupo 401", schedule: "Lunes 10:00 - 12:00", teacher: "Lic. Pérez", code: "ALG401" },
                    { name: "Grupo 402", schedule: "Miércoles 14:00 - 16:00", teacher: "Dra. Gómez", code: "CAL402" }
                ],
                schedule: {
                    "8:00-9:00": ["", "", "", "", ""],
                    "9:00-10:00": ["", "", "", "", ""],
                    "10:00-11:00": ["Grupo 401", "", "Grupo 402", "", "Grupo 401"],
                    "11:00-12:00": ["Grupo 401", "", "Grupo 402", "", "Grupo 401"],
                    "12:00-13:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "13:00-14:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "14:00-15:00": ["", "Cálculo", "", "Cálculo", ""],
                    "15:00-16:00": ["", "Cálculo", "", "Cálculo", ""]
                }
            },
            "E102": {
                status: "ocupado",
                groups: [
                    { name: "Grupo 501", schedule: "Martes 8:00 - 10:00", teacher: "Dra. Gómez", code: "CAL501" },
                    { name: "Grupo 502", schedule: "Jueves 10:00 - 12:00", teacher: "M.Sc. Rodríguez", code: "QUI502" }
                ],
                schedule: {
                    "8:00-9:00": ["", "Grupo 501", "", "Grupo 502", ""],
                    "9:00-10:00": ["", "Grupo 501", "", "Grupo 502", ""],
                    "10:00-11:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "11:00-12:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "12:00-13:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "13:00-14:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "14:00-15:00": ["", "", "Grupo 503", "", "Grupo 503"],
                    "15:00-16:00": ["", "", "Grupo 503", "", "Grupo 503"]
                }
            },
            "F101": {
                status: "ocupado",
                groups: [
                    { name: "Grupo 601", schedule: "Lunes 9:00 - 11:00", teacher: "Arq. Pérez", code: "ING601" },
                    { name: "Grupo 602", schedule: "Miércoles 13:00 - 15:00", teacher: "Ing. López", code: "DIB602" }
                ],
                schedule: {
                    "8:00-9:00": ["", "", "", "", ""],
                    "9:00-10:00": ["Grupo 601", "", "Grupo 602", "", "Grupo 601"],
                    "10:00-11:00": ["Grupo 601", "", "Grupo 602", "", "Grupo 601"],
                    "11:00-12:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "12:00-13:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "13:00-14:00": ["", "Dibujo", "", "Dibujo", ""],
                    "14:00-15:00": ["", "Dibujo", "", "Dibujo", ""],
                    "15:00-16:00": ["Libre", "Libre", "Libre", "Libre", "Libre"]
                }
            },
            "E405": {
                status: "ocupado",
                groups: [
                    { name: "Grupo 701", schedule: "Martes 10:00 - 12:00", teacher: "M.Sc. Rodríguez", code: "QUI701" },
                    { name: "Grupo 702", schedule: "Jueves 14:00 - 16:00", teacher: "Lic. Hernández", code: "LAB702" }
                ],
                schedule: {
                    "8:00-9:00": ["", "", "", "", ""],
                    "9:00-10:00": ["", "", "", "", ""],
                    "10:00-11:00": ["", "Grupo 701", "", "Grupo 702", ""],
                    "11:00-12:00": ["", "Grupo 701", "", "Grupo 702", ""],
                    "12:00-13:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "13:00-14:00": ["Libre", "Libre", "Libre", "Libre", "Libre"],
                    "14:00-15:00": ["", "", "Laboratorio", "", "Laboratorio"],
                    "15:00-16:00": ["", "", "Laboratorio", "", "Laboratorio"]
                }
            }
        };

        // Configuración de salones por piso (para el modal de piso)
        const floorSalons = {
            "D1": ["D101", "D102", "D103", "D104", "D105", "D106"],
            "D2": ["D201", "D202", "D203", "D204", "D205", "D206"],
            "D3": ["D301", "D302", "D303", "D304", "D305", "D306"],
            "D4": ["D401", "D402", "D403", "D404", "D405", "D406"],
            "E1": ["E101", "E102", "E103", "E104", "E105", "E106"],
            "E2": ["E201", "E202", "E203", "E204", "E205", "E206"],
            "E3": ["E301", "E302", "E303", "E304", "E305", "E306"],
            "E4": ["E401", "E402", "E403", "E404", "E405"],
            "F1": ["F101", "F102", "F103", "F104"],
            "F2": ["F201", "F202", "F203", "F204"],
            "F3": ["F301", "F302", "F303", "F304"],
            "F4": ["F401", "F402", "F403", "F404"]
        };

        // Variables globales
        let currentFilter = 'all';
        let isInitialized = false;

        // Inicializar la página cuando se carga
        document.addEventListener("DOMContentLoaded", function() {
            if (!isInitialized) {
                initializePage();
                isInitialized = true;
            }
        });

        // Inicializar la página
        function initializePage() {
            // Inicializar datos de salones
            initializeSalonData();

            // Configurar eventos básicos
            setupBasicEvents();

            // Configurar el menú lateral
            setupMenuToggle();

            // Iniciar con sidebar colapsado
            document.body.classList.add('sidebar-collapsed');

            // Establecer ícono inicial del menú
            const menuToggle = document.getElementById('menuToggle');
            if (menuToggle) {
                const icon = menuToggle.querySelector('i');
                if (icon) {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }

            // Mostrar contenido inicial
            loadHomeContent();

            // Aplicar permisos de usuario
            applyUserPermissions();

            // Mostrar notificación de bienvenida
            setTimeout(() => {
                showNotification('¡Bienvenido al sistema de gestión de edificios!', 'info');
            }, 1000);
        }

        // Configurar el toggle del menú
        function setupMenuToggle() {
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            if (menuToggle && sidebar) {
                menuToggle.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        // Comportamiento móvil
                        sidebar.classList.toggle('active');
                        sidebarOverlay.classList.toggle('active');
                    } else {
                        // Comportamiento desktop - menú hamburguesa
                        document.body.classList.toggle('sidebar-collapsed');
                    }

                    // Cambiar el ícono del botón
                    const icon = menuToggle.querySelector('i');
                    if ((window.innerWidth <= 768 && sidebar.classList.contains('active')) ||
                        (window.innerWidth > 768 && !document.body.classList.contains('sidebar-collapsed'))) {
                        icon.classList.remove('fa-bars');
                        icon.classList.add('fa-times');
                    } else {
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });

                // Cerrar menú al hacer clic en el overlay (solo móvil)
                if (sidebarOverlay) {
                    sidebarOverlay.addEventListener('click', function() {
                        sidebar.classList.remove('active');
                        sidebarOverlay.classList.remove('active');

                        // Restaurar ícono
                        const icon = menuToggle.querySelector('i');
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    });
                }

                // Cerrar menú al hacer clic en un enlace del menú (solo móvil)
                document.querySelectorAll('.sidebar-link').forEach(link => {
                    link.addEventListener('click', function() {
                        if (window.innerWidth <= 768) {
                            sidebar.classList.remove('active');
                            sidebarOverlay.classList.remove('active');

                            // Restaurar ícono
                            const icon = menuToggle.querySelector('i');
                            icon.classList.remove('fa-times');
                            icon.classList.add('fa-bars');
                        }
                    });
                });
            }
        }

        // Inicializar datos de salones que no están en salonData
        function initializeSalonData() {
            const salonCards = document.querySelectorAll('.salon-card');
            salonCards.forEach(card => {
                const salonId = card.textContent.trim();
                if (!salonData[salonId]) {
                    // Determinar estado basado en las clases del elemento
                    let status = "disponible";
                    if (card.classList.contains('ocupado')) {
                        status = "ocupado";
                    } else if (card.classList.contains('accesible')) {
                        status = "accesible";
                    }
                    
                    salonData[salonId] = {
                        status: status,
                        groups: []
                    };
                }
            });
        }

        // Configurar eventos básicos
        function setupBasicEvents() {
            // Manejo del input de búsqueda
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && typeof searchSalons === 'function') {
                        searchSalons();
                    }
                });
            }
        }

        // Mostrar detalles del salón con GRUPOS
        function showSalonDetails(salonId) {
            const modal = document.getElementById("salonModal");
            const salonName = document.getElementById("salonName");
            const salonStatus = document.getElementById("salonStatus");
            const groupsList = document.getElementById("groupsList");
            const scheduleBody = document.getElementById("scheduleBody");
            const currentStatusText = document.getElementById("currentStatusText");

            // Obtener datos del salón
            const data = salonData[salonId];

            if (!data) {
                // Si no hay datos específicos, mostrar información básica
                salonName.textContent = salonId;
                salonStatus.innerHTML = '<div class="status-badge available">Disponible</div>';
                groupsList.innerHTML = '<div class="group-item">No hay grupos asignados actualmente.</div>';
                currentStatusText.textContent = "Este salón está disponible todo el día.";
            } else {
                // Actualizar contenido del modal
                salonName.textContent = salonId;

                // Mostrar estado
                let statusHTML = '';
                let currentStatus = "";
                switch(data.status) {
                    case "disponible":
                        statusHTML = '<div class="status-badge available">Disponible</div>';
                        currentStatus = "Este salón está disponible actualmente.";
                        break;
                    case "ocupado":
                        statusHTML = '<div class="status-badge occupied">Ocupado</div>';
                        currentStatus = "Este salón está ocupado actualmente.";
                        break;
                    case "accesible":
                        statusHTML = '<div class="status-badge accessible">Accesible</div>';
                        currentStatus = "Este salón es accesible para personas con discapacidad.";
                        break;
                    default:
                        statusHTML = '<div class="status-badge available">Disponible</div>';
                        currentStatus = "Este salón está disponible actualmente.";
                }
                salonStatus.innerHTML = statusHTML;
                currentStatusText.textContent = currentStatus;

                // Mostrar lista de GRUPOS
                let groupsHTML = '';
                if (data.groups && data.groups.length > 0) {
                    data.groups.forEach(group => {
                        groupsHTML += `
                            <div class="group-item">
                                <div class="group-name">${group.name} - ${group.code}</div>
                                <div class="group-schedule">${group.schedule} | Profesor: ${group.teacher}</div>
                            </div>
                        `;
                    });
                } else {
                    groupsHTML = '<div class="group-item">No hay grupos asignados actualmente.</div>';
                }
                groupsList.innerHTML = groupsHTML;

                // Mostrar horario
                scheduleBody.innerHTML = '';
                const days = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes"];

                // Obtener hora actual para resaltar
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();
                const currentTime = currentHour + ":" + (currentMinute < 10 ? "0" : "") + currentMinute;

                for (const [timeSlot, daySchedule] of Object.entries(data.schedule)) {
                    const [startTime, endTime] = timeSlot.split("-");

                    // Verificar si la hora actual está en este intervalo
                    const isCurrentTimeSlot = isTimeInRange(currentTime, startTime, endTime);

                    const row = document.createElement('tr');
                    if (isCurrentTimeSlot) {
                        row.className = 'current-time';
                    }

                    // Celda de hora
                    const timeCell = document.createElement('td');
                    timeCell.className = 'time-slot';
                    timeCell.textContent = timeSlot;
                    row.appendChild(timeCell);

                    // Celdas para cada día
                    for (let i = 0; i < 5; i++) {
                        const dayCell = document.createElement('td');
                        dayCell.textContent = daySchedule[i] || "";

                        // Resaltar si está ocupado
                        if (daySchedule[i] && daySchedule[i] !== "Libre" && daySchedule[i] !== "") {
                            dayCell.style.color = "var(--ocupado)";
                            dayCell.style.fontWeight = "bold";
                        }

                        row.appendChild(dayCell);
                    }

                    scheduleBody.appendChild(row);
                }
            }

            // Mostrar modal
            modal.style.display = "block";
        }

        function closeModal() {
            const modal = document.getElementById("salonModal");
            if (modal) {
                modal.style.display = "none";
            }
        }

        // Cerrar modal al hacer clic fuera de él
        window.onclick = function(event) {
            const salonModal = document.getElementById("salonModal");
            const floorModal = document.getElementById("floorModal");

            if (event.target == salonModal) {
                closeSalonModal();
            }

            if (event.target == floorModal) {
                closeFloorModal();
            }
        }

        // Mostrar modal del piso con sus salones
        function showFloorModal(building, floor) {
            const floorKey = `${building}${floor}`;
            const salons = floorSalons[floorKey];

            if (!salons) {
                showNotification(`No hay datos para el piso ${floor} del edificio ${building}`, 'warning');
                return;
            }

            // Actualizar título del modal
            document.getElementById('floorModalTitle').textContent = `Edificio ${building} - Piso ${floor}`;

            // Obtener contenedor y limpiarlo
            const container = document.getElementById('floorSalonsContainer');
            container.innerHTML = '';

            // Agregar cada salón al modal
            salons.forEach(salonId => {
                const salonInfo = salonData[salonId] || { status: "disponible" };
                const salonCard = document.createElement('div');
                salonCard.className = `salon-card-modal ${salonInfo.status}`;
                salonCard.textContent = salonId;
                salonCard.onclick = () => {
                    closeFloorModal();
                    setTimeout(() => showSalonDetails(salonId), 300);
                };

                // Agregar indicador de estado
                const statusIndicator = document.createElement('div');
                statusIndicator.className = 'status-badge';
                statusIndicator.textContent = salonInfo.status === 'ocupado' ? 'Ocupado' :
                                            salonInfo.status === 'disponible' ? 'Disponible' : 'Accesible';
                statusIndicator.style.cssText = 'position: absolute; top: 5px; right: 5px; font-size: 10px; padding: 2px 6px;';

                salonCard.appendChild(statusIndicator);
                container.appendChild(salonCard);
            });

            // Mostrar modal
            document.getElementById('floorModal').style.display = 'block';
        }

        // Cerrar modal del piso
        function closeFloorModal() {
            document.getElementById('floorModal').style.display = 'none';
        }

        // Mostrar todos los salones (abrir primer piso del primer edificio)
        function showAllSalons() {
            showFloorModal('D', 1);
            showNotification('Mostrando todos los salones. Selecciona un piso para ver los salones.', 'info');
        }

        // Función auxiliar para verificar si una hora está en un rango
        function isTimeInRange(time, start, end) {
            const timeToMinutes = t => {
                const [h, m] = t.split(":").map(Number);
                return h * 60 + m;
            };

            const t = timeToMinutes(time);
            const s = timeToMinutes(start);
            const e = timeToMinutes(end);

            return t >= s && t <= e;
        }

        // Cerrar modal del salón
        function closeSalonModal() {
            document.getElementById("salonModal").style.display = "none";
        }

        // Funciones para edificios y salones (versión simplificada)
        function toggleFloor(floorId) {
            const floorGrid = document.getElementById(floorId);
            if (floorGrid) {
                floorGrid.classList.toggle('active');
                const toggleButton = floorGrid.previousElementSibling;
                if (toggleButton) toggleButton.classList.toggle('active');
            }
        }

        function searchSalons() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();

            if (searchTerm === '') {
                showNotification('Ingresa un término de búsqueda', 'warning');
                return;
            }

            // Buscar salón por nombre
            let foundSalon = null;
            for (const floorKey in floorSalons) {
                const salons = floorSalons[floorKey];
                foundSalon = salons.find(salon => salon.toLowerCase().includes(searchTerm));
                if (foundSalon) break;
            }

            // Si no encontró por nombre de salón, buscar por grupo
            if (!foundSalon) {
                for (const salonId in salonData) {
                    const salon = salonData[salonId];
                    if (salon.groups && salon.groups.length > 0) {
                        const foundGroup = salon.groups.find(group =>
                            group.name.toLowerCase().includes(searchTerm) ||
                            group.code.toLowerCase().includes(searchTerm)
                        );
                        if (foundGroup) {
                            foundSalon = salonId;
                            break;
                        }
                    }
                }
            }

            if (foundSalon) {
                // Extraer edificio y piso del salón encontrado
                const building = foundSalon.charAt(0);
                const floor = parseInt(foundSalon.charAt(1));

                // Mostrar modal del piso
                showFloorModal(building, floor);

                setTimeout(() => {
                    // Resaltar el salón encontrado en el modal
                    const salonCards = document.querySelectorAll('.salon-card-modal');
                    salonCards.forEach(card => {
                        if (card.textContent.includes(foundSalon)) {
                            card.style.animation = 'pulse 1s infinite';
                            card.style.boxShadow = '0 0 10px var(--amarillo-medio)';
                            card.style.transform = 'scale(1.1)';
                            setTimeout(() => {
                                card.style.animation = '';
                                card.style.boxShadow = '';
                                card.style.transform = '';
                            }, 3000);

                            // Mostrar detalles después de un breve retraso
                            setTimeout(() => {
                                card.click();
                            }, 1000);
                        }
                    });

                    showNotification(`Resultado encontrado: ${foundSalon}`, 'success');
                }, 500);
            } else {
                showNotification(`No se encontraron resultados para: "${searchTerm}"`, 'warning');
            }
        }

        // Notificaciones push
        function showNotification(message, type = 'info') {
            // Eliminar notificaciones existentes
            document.querySelectorAll('.notification').forEach(notification => {
                notification.remove();
            });

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 10);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        function filterByStatus(status) {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => btn.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            if (typeof showNotification === 'function') {
                showNotification(`Filtrado por: ${status}`, 'info');
            }
        }

        function showReports() {
            if (typeof showNotification === 'function') {
                showNotification('Módulo de reportes en desarrollo', 'info');
            }
        }

        // Exponer funciones globalmente para compatibilidad con Index.html
        window.toggleFloor = toggleFloor;
        window.showSalonDetails = showSalonDetails;
        window.searchSalons = searchSalons;
        window.filterByStatus = filterByStatus;
        window.showReports = showReports;
        window.closeModal = closeModal;
        window.initializePage = initializePage;

        // Funciones que serán llamadas desde Index.html
        window.loadContent = function(page) {
            const contentSection = document.getElementById('content-section');
            if (!contentSection) return;

            // Set active link
            document.querySelectorAll('.sidebar-link').forEach(link => link.classList.remove('active'));
            const activeLink = document.querySelector(`.sidebar-link[onclick*="loadContent('${page}')"]`);
            if (activeLink) activeLink.classList.add('active');

            if (page === 'inicio') {
                loadHomeContent();
            } else if (page === 'edificios') {
                loadBuildingsContent();
            } else if (page === 'usuarios') {
                loadUsersContent();
            } else if (page === 'configuracion') {
                loadSettingsContent();
            }

            // Cerrar sidebar en móviles
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const sidebarOverlay = document.getElementById('sidebarOverlay');
                const menuToggle = document.getElementById('menuToggle');

                if (sidebar && sidebarOverlay && menuToggle) {
                    sidebar.classList.remove('active');
                    sidebarOverlay.classList.remove('active');

                    const icon = menuToggle.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }
        };

        window.loadHomeContent = function() {
            const contentSection = document.getElementById('content-section');
            if (!contentSection) return;
            
            contentSection.innerHTML = `
                <div class="welcome-section">
                    <h1 class="welcome-title">Bienvenido al Sistema de Gestión</h1>
                    <p class="welcome-subtitle">Universidad Autónoma de Baja California</p>
                </div>
                
                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <div class="card-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <div class="card-content">
                            <h3>3 Edificios</h3>
                            <p>Disponibles para gestión</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                                               <div class="card-icon">
                            <i class="fas fa-door-open"></i>
                        </div>
                        <div class="card-content">
                            <h3>63 Salones</h3>
                            <p>Total en el sistema</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-content">
                            <h3 id="totalUsers">Cargando...</h3>
                            <p>Usuarios registrados</p>
                        </div>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <h2>Acciones Rápidas</h2>
                    <div class="actions-grid">
                        <button class="action-btn" onclick="loadBuildingsContent()">
                            <i class="fas fa-search"></i>
                            <span>Buscar Salón</span>
                        </button>
                        <button class="action-btn" onclick="loadUsersContent()" id="manageUsersBtn">
                            <i class="fas fa-user-plus"></i>
                            <span>Gestionar Usuarios</span>
                        </button>
                        <button class="action-btn" onclick="showReports()">
                            <i class="fas fa-chart-bar"></i>
                            <span>Ver Reportes</span>
                        </button>
                    </div>
                </div>
            `;
            
            // Aplicar permisos de usuario después de cargar el contenido
            setTimeout(() => {
                applyUserPermissions();
            }, 100);
            
            // Cargar estadísticas
            loadStatistics();
        };
        
        // Función para cargar estadísticas
        function loadStatistics() {
            if (typeof google === 'undefined' || typeof google.script === 'undefined') {
                // Datos mock para entorno local
                setTimeout(() => {
                    const totalUsersElement = document.getElementById('totalUsers');
                    if (totalUsersElement) {
                        totalUsersElement.textContent = '5'; // Mock data
                    }
                }, 300);
            } else {
                google.script.run
                    .withSuccessHandler(function(result) {
                        if (result.success) {
                            const totalUsersElement = document.getElementById('totalUsers');
                            if (totalUsersElement) {
                                totalUsersElement.textContent = result.estadisticas.usuariosActivos;
                            }
                        }
                    })
                    .obtenerEstadisticas();
            }
        }

        // Función para aplicar permisos de usuario (replicada para Principal.html)
        function applyUserPermissions() {
            const userIsAdmin = localStorage.getItem('userIsAdmin') === 'true';
            const userRole = localStorage.getItem('userRole');

            if (!userIsAdmin && userRole !== 'admin') {
                // Ocultar la sección de usuarios para usuarios regulares
                const usersLink = document.querySelector('.sidebar-link[onclick*="loadContent(\'usuarios\')"]');
                if (usersLink) {
                    usersLink.style.display = 'none';
                    console.log('Sección Usuarios oculta para usuario regular (Principal)');
                }

                // También ocultar botón de gestionar usuarios en dashboard
                const manageUsersBtn = document.getElementById('manageUsersBtn');
                if (manageUsersBtn) {
                    manageUsersBtn.style.display = 'none';
                    console.log('Botón Gestionar Usuarios oculto para usuario regular (Principal)');
                }
            } else {
                console.log('Usuario administrador - todas las opciones visibles (Principal)');
            }
        }
        
        // Exponer la función globalmente
        window.applyUserPermissions = applyUserPermissions;

        window.loadBuildingsContent = function() {
            const contentSection = document.getElementById('content-section');
            if (!contentSection) return;

            contentSection.innerHTML = `
                <div class="welcome-section">
                    <h1 class="welcome-title">Gestión de Edificios Escolares</h1>
                    <p class="welcome-subtitle">Haz clic en cada piso para ver los salones disponibles</p>
                </div>

                <div class="controls">
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Buscar salón o grupo...">
                        <button onclick="searchSalons()">Buscar</button>
                    </div>
                    <div class="filters">
                        <button class="filter-btn active" onclick="showAllSalons()">Ver todos</button>
                    </div>
                </div>

                <div class="buildings-container" id="buildingsContainer">
                    <div class="loading-buildings">
                        <div class="loader"></div>
                        <p>Cargando edificios...</p>
                    </div>
                </div>
            `;

            // Cargar edificios
            loadBuildings();
        };

        // Función para cargar edificios desde el servidor
        function loadBuildings() {
            if (typeof google === 'undefined' || typeof google.script === 'undefined') {
                // Datos mock para entorno local
                setTimeout(() => {
                    const mockEdificios = {
                        'D': {
                            nombre: 'Edificio D',
                            totalSalones: 24,
                            pisos: 4,
                            salones: {
                                '1': ['D101', 'D102', 'D103', 'D104', 'D105', 'D106'],
                                '2': ['D201', 'D202', 'D203', 'D204', 'D205', 'D206'],
                                '3': ['D301', 'D302', 'D303', 'D304', 'D305', 'D306'],
                                '4': ['D401', 'D402', 'D403', 'D404', 'D405', 'D406']
                            }
                        },
                        'E': {
                            nombre: 'Edificio E',
                            totalSalones: 23,
                            pisos: 4,
                            salones: {
                                '1': ['E101', 'E102', 'E103', 'E104', 'E105', 'E106'],
                                '2': ['E201', 'E202', 'E203', 'E204', 'E205', 'E206'],
                                '3': ['E301', 'E302', 'E303', 'E304', 'E305', 'E306'],
                                '4': ['E401', 'E402', 'E403', 'E404', 'E405']
                            }
                        },
                        'F': {
                            nombre: 'Edificio F',
                            totalSalones: 16,
                            pisos: 4,
                            salones: {
                                '1': ['F101', 'F102', 'F103', 'F104'],
                                '2': ['F201', 'F202', 'F203', 'F204'],
                                '3': ['F301', 'F302', 'F303', 'F304'],
                                '4': ['F401', 'F402', 'F403', 'F404']
                            }
                        }
                    };
                    renderBuildings(mockEdificios);
                }, 500);
            } else {
                google.script.run
                    .withSuccessHandler(function(result) {
                        if (result.success) {
                            renderBuildings(result.edificios);
                        } else {
                            document.getElementById('buildingsContainer').innerHTML = `
                                <div class="error-message">
                                    <p>Error: ${result.message}</p>
                                    <button onclick="loadBuildings()">Reintentar</button>
                                </div>
                            `;
                        }
                    })
                    .withFailureHandler(function(error) {
                        document.getElementById('buildingsContainer').innerHTML = `
                            <div class="error-message">
                                <p>Error de conexión</p>
                                <button onclick="loadBuildings()">Reintentar</button>
                            </div>
                        `;
                    })
                    .obtenerEdificios();
            }
        }

        // Función para renderizar edificios
        function renderBuildings(edificios) {
            const container = document.getElementById('buildingsContainer');
            if (!container) return;

            let html = '';

            for (const [key, edificio] of Object.entries(edificios)) {
                html += `
                    <div class="building-card">
                        <div class="building-header">
                            <div class="building-icon">${key}</div>
                            <div class="building-info">
                                <h3>${edificio.nombre}</h3>
                                <p>Total: ${edificio.totalSalones} salones | ${edificio.pisos} pisos</p>
                            </div>
                        </div>
                `;

                // Agregar pisos
                for (const [piso, salones] of Object.entries(edificio.salones)) {
                    const floorId = `floor-${key.toLowerCase()}-${piso}`;
                    html += `
                        <button class="floor-toggle" onclick="showFloorModal('${key}', ${piso})">
                            <span>Piso ${piso}</span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    `;
                }

                html += `</div>`;
            }

            container.innerHTML = html;
        }

        window.loadUsersContent = function() {
            // Verificar permisos de administrador
            const userIsAdmin = localStorage.getItem('userIsAdmin') === 'true';
            const userRole = localStorage.getItem('userRole');

            if (!userIsAdmin && userRole !== 'admin') {
                if (typeof showNotification === 'function') {
                    showNotification('No tienes permisos para acceder a la gestión de usuarios', 'error');
                }
                return;
            }

            const contentSection = document.getElementById('content-section');
            if (!contentSection) return;

            contentSection.innerHTML = `
                <div class="section-header">
                    <h1>Gestión de Usuarios</h1>
                    <p>Administra los usuarios del sistema</p>
                </div>

                <div class="users-controls">
                    <button class="btn-primary" onclick="showAddUserForm()">
                        <i class="fas fa-user-plus"></i> Nuevo Usuario
                    </button>
                </div>

                <div class="users-list-container" id="usersListContainer">
                    <div class="loading">
                        <div class="loader"></div>
                        <p>Cargando usuarios...</p>
                    </div>
                </div>
            `;

            // Cargar lista de usuarios
            loadUsersList();
        };

        // Función para cargar lista de usuarios
        function loadUsersList() {
            if (typeof google === 'undefined' || typeof google.script === 'undefined') {
                // Datos mock para entorno local
                setTimeout(() => {
                    const mockUsers = [
                        { id: '1', nombre: 'Admin Local', email: 'admin@local.com', rol: 'admin', activo: true },
                        { id: '2', nombre: 'Usuario 1', email: 'user1@local.com', rol: 'user', activo: true },
                        { id: '3', nombre: 'Usuario 2', email: 'user2@local.com', rol: 'user', activo: false },
                        { id: '4', nombre: 'Usuario 3', email: 'user3@local.com', rol: 'user', activo: true },
                        { id: '5', nombre: 'Usuario 4', email: 'user4@local.com', rol: 'user', activo: true },
                        { id: '6', nombre: 'Usuario 5', email: 'user5@local.com', rol: 'user', activo: false },
                        { id: '7', nombre: 'Usuario 6', email: 'user6@local.com', rol: 'user', activo: true },
                        { id: '8', nombre: 'Usuario 7', email: 'user7@local.com', rol: 'user', activo: true },
                        { id: '9', nombre: 'Usuario 8', email: 'user8@local.com', rol: 'user', activo: false },
                        { id: '10', nombre: 'Usuario 9', email: 'user9@local.com', rol: 'user', activo: true },
                        { id: '11', nombre: 'Usuario 10', email: 'user10@local.com', rol: 'user', activo: true },
                        { id: '12', nombre: 'Usuario 11', email: 'user11@local.com', rol: 'user', activo: false },
                        { id: '13', nombre: 'Usuario 12', email: 'user12@local.com', rol: 'user', activo: true },
                        { id: '14', nombre: 'Usuario 13', email: 'user13@local.com', rol: 'user', activo: true },
                        { id: '15', nombre: 'Usuario 14', email: 'user14@local.com', rol: 'user', activo: false },
                        { id: '16', nombre: 'Usuario 15', email: 'user15@local.com', rol: 'user', activo: true },
                        { id: '17', nombre: 'Usuario 16', email: 'user16@local.com', rol: 'user', activo: true },
                        { id: '18', nombre: 'Usuario 17', email: 'user17@local.com', rol: 'user', activo: false },
                        { id: '19', nombre: 'Usuario 18', email: 'user18@local.com', rol: 'user', activo: true },
                        { id: '20', nombre: 'Usuario 19', email: 'user19@local.com', rol: 'user', activo: true },
                        { id: '21', nombre: 'Usuario 20', email: 'user20@local.com', rol: 'user', activo: false },
                        { id: '22', nombre: 'Usuario 21', email: 'user21@local.com', rol: 'user', activo: true },
                        { id: '23', nombre: 'Usuario 22', email: 'user22@local.com', rol: 'user', activo: true },
                        { id: '24', nombre: 'Usuario 23', email: 'user23@local.com', rol: 'user', activo: false },
                        { id: '25', nombre: 'Usuario 24', email: 'user24@local.com', rol: 'user', activo: true }
                    ];
                    renderUsersList(mockUsers);
                }, 500);
            } else {
                google.script.run
                    .withSuccessHandler(function(users) {
                        renderUsersList(users);
                    })
                    .withFailureHandler(function(error) {
                        document.getElementById('usersListContainer').innerHTML = `
                            <div class="error-message">
                                <p>Error al cargar usuarios</p>
                                <button onclick="loadUsersList()">Reintentar</button>
                            </div>
                        `;
                    })
                    .obtenerUsuarios();
            }
        }

        // Función para renderizar lista de usuarios
        function renderUsersList(users) {
            const container = document.getElementById('usersListContainer');
            if (!container) return;

            if (users.length === 0) {
                container.innerHTML = '<p>No hay usuarios registrados.</p>';
                return;
            }

            let html = `
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Rol</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            users.forEach(user => {
                html += `
                    <tr>
                        <td>${user.nombre}</td>
                        <td>${user.email}</td>
                        <td>${user.rol}</td>
                        <td>${user.activo ? '<span class="status-active">Activo</span>' : '<span class="status-inactive">Inactivo</span>'}</td>
                        <td>
                            <div class="user-actions">
                                <button class="btn-small btn-edit" onclick="editUser('${user.id}', '${user.nombre}', '${user.email}', '${user.rol}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-small btn-reset" onclick="resetUserPassword('${user.id}', '${user.nombre}')">
                                    <i class="fas fa-key"></i>
                                </button>
                                ${user.activo ?
                                    `<button class="btn-small btn-deactivate" onclick="deactivateUser('${user.id}', '${user.nombre}')">
                                        <i class="fas fa-user-times"></i>
                                    </button>` :
                                    `<button class="btn-small btn-activate" onclick="activateUser('${user.id}', '${user.nombre}')">
                                        <i class="fas fa-user-check"></i>
                                    </button>`
                                }
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            container.innerHTML = html;
        }

        window.loadSettingsContent = function() {
            const contentSection = document.getElementById('content-section');
            if (!contentSection) return;

            contentSection.innerHTML = `
                <div class="section-header">
                    <h1>Configuración del Sistema</h1>
                    <p>Configura las opciones del sistema</p>
                </div>

                <div class="settings-container">
                    <div class="settings-card">
                        <h3><i class="fas fa-info-circle"></i> Información del Sistema</h3>
                        <div class="settings-info">
                            <p><strong>Versión:</strong> 2.0</p>
                            <p><strong>Desarrollado por:</strong> LIDE - UABC</p>
                            <p><strong>Correo:</strong> lide.laboratorio2025@gmail.com</p>
                            <p><strong>Última actualización:</strong> ${new Date().toLocaleDateString()}</p>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-database"></i> Base de Datos</h3>
                        <div class="settings-info">
                            <p id="dbStatus">Verificando conexión...</p>
                            <button class="btn-secondary" onclick="testDatabase()">Probar Conexión</button>
                        </div>
                    </div>
                </div>
            `;

            // Probar conexión a la base de datos
            testDatabase();
        };

        window.testDatabase = function() {
            if (typeof google === 'undefined' || typeof google.script === 'undefined') {
                // Simular test de conexión local
                setTimeout(() => {
                    document.getElementById('dbStatus').innerHTML = `
                        <span style="color: #4CAF50;">✓ Conexión local - OK</span>
                    `;
                }, 500);
            } else {
                google.script.run
                    .withSuccessHandler(function(result) {
                        document.getElementById('dbStatus').innerHTML = `
                            <span style="color: #4CAF50;">✓ ${result}</span>
                        `;
                    })
                    .withFailureHandler(function(error) {
                        document.getElementById('dbStatus').innerHTML = `
                            <span style="color: #f44336;">✗ Error: ${error}</span>
                        `;
                    })
                    .testConexion();
            }
        };

      // ============================================
// FUNCIONES PARA GESTIÓN DE USUARIOS (GLOBALES)
// ============================================

window.editUser = function(id, nombre, email, rol) {
    // Verificar permisos
    const userIsAdmin = localStorage.getItem('userIsAdmin') === 'true';
    const userRole = localStorage.getItem('userRole');
    
    if (!userIsAdmin && userRole !== 'admin') {
        showNotification('No tienes permisos para editar usuarios', 'error');
        return;
    }
    
    // Crear formulario personalizado para SweetAlert2
    const formHTML = `
        <div class="swal2-form-group">
            <label class="swal2-label">ID o Matricula</label>
            <input type="text" id="editUserId" class="swal2-input" value="${id}" readonly>
            <small>Identificador único del usuario (no modificable)</small>
        </div>
        <div class="swal2-form-group">
            <label class="swal2-label">Nombre Completo *</label>
            <input type="text" id="editUserName" class="swal2-input" value="${nombre}" required>
        </div>
        <div class="swal2-form-group">
            <label class="swal2-label">Email *</label>
            <input type="email" id="editUserEmail" class="swal2-input" value="${email}" required>
        </div>
        <div class="swal2-form-group">
            <label class="swal2-label">Rol *</label>
            <select id="editUserRole" class="swal2-input" required>
                <option value="admin" ${rol === 'admin' ? 'selected' : ''}>Administrador</option>
                <option value="user" ${rol === 'user' ? 'selected' : ''}>Usuario</option>
            </select>
        </div>
        <small style="color: var(--gris-texto);">* Campos obligatorios</small>
    `;
    
    Swal.fire({
        title: 'Editar Usuario',
        html: formHTML,
        showCancelButton: true,
        confirmButtonText: 'Guardar Cambios',
        cancelButtonText: 'Cancelar',
        width: window.innerWidth <= 480 ? '95%' : '500px',
        preConfirm: () => {
            const nombre = document.getElementById('editUserName').value.trim();
            const email = document.getElementById('editUserEmail').value.trim();
            const rol = document.getElementById('editUserRole').value;
            
            if (!nombre || !email || !rol) {
                Swal.showValidationMessage('Todos los campos obligatorios deben completarse');
                return false;
            }
            
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                Swal.showValidationMessage('Ingresa un email válido');
                return false;
            }
            
            return { id, nombre, email, rol };
        }
    }).then((result) => {
        if (result.isConfirmed) {
            if (typeof google === 'undefined') {
                // Simular actualización local
                showNotification('Usuario actualizado exitosamente', 'success');
                loadUsersList();
            } else {
                google.script.run
                    .withSuccessHandler(function(response) {
                        if (response.success) {
                            showNotification('Usuario actualizado exitosamente', 'success');
                            loadUsersList();
                        } else {
                            showNotification(response.message, 'error');
                        }
                    })
                    .withFailureHandler(function(error) {
                        showNotification('Error: ' + error.message, 'error');
                    })
                    .actualizarUsuario(result.value.id, result.value);
            }
        }
    });
};

window.deactivateUser = function(id, nombre) {
    Swal.fire({
        title: '¿Desactivar usuario?',
        html: `¿Estás seguro de desactivar a <strong>${nombre}</strong>?<br><br>
               <small>El usuario no podrá acceder al sistema hasta que sea reactivado.</small>`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Sí, desactivar',
        cancelButtonText: 'Cancelar',
        reverseButtons: true
    }).then((result) => {
        if (result.isConfirmed) {
            if (typeof google === 'undefined' || typeof google.script === 'undefined') {
                // Simular desactivación local
                setTimeout(() => {
                    Swal.fire(
                        '¡Desactivado!',
                        `El usuario ${nombre} ha sido desactivado.`,
                        'success'
                    );
                    loadUsersList();
                }, 500);
            } else {
                google.script.run
                    .withSuccessHandler(function(response) {
                        if (response.success) {
                            Swal.fire(
                                '¡Desactivado!',
                                `El usuario ${nombre} ha sido desactivado.`,
                                'success'
                            );
                            loadUsersList();
                        } else {
                            Swal.fire('Error', response.message, 'error');
                        }
                    })
                    .withFailureHandler(function(error) {
                        Swal.fire('Error', 'Error del sistema: ' + error.message, 'error');
                    })
                    .eliminarUsuario(id);
            }
        }
    });
};

window.resetUserPassword = function(id, nombre) {
    Swal.fire({
        title: '¿Restablecer contraseña?',
        html: `¿Restablecer la contraseña de <strong>${nombre}</strong>?<br><br>
               <small>Se generará una nueva contraseña temporal que se mostrará una sola vez.</small>`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#4CAF50',
        cancelButtonColor: '#757575',
        confirmButtonText: 'Sí, restablecer',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            if (typeof google === 'undefined' || typeof google.script === 'undefined') {
                // Simular restablecimiento local
                const tempPassword = 'TempPass' + Math.floor(Math.random() * 1000);
                setTimeout(() => {
                    Swal.fire({
                        title: 'Contraseña restablecida',
                        html: `
                            <p>Contraseña temporal generada para <strong>${nombre}</strong>:</p>
                            <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 15px 0;">
                                <code style="font-size: 18px; font-weight: bold; color: #2E7D32;">${tempPassword}</code>
                            </div>
                            <p><small>¡Guarda esta contraseña! No se volverá a mostrar.</small></p>
                        `,
                        icon: 'success',
                        showConfirmButton: true,
                        confirmButtonText: 'Copiar contraseña'
                    }).then(() => {
                        // Copiar al portapapeles
                        navigator.clipboard.writeText(tempPassword).then(() => {
                            showNotification('Contraseña copiada al portapapeles', 'success');
                        });
                    });
                }, 500);
            } else {
                google.script.run
                    .withSuccessHandler(function(response) {
                        if (response.success) {
                            Swal.fire({
                                title: 'Contraseña restablecida',
                                html: `
                                    <p>Contraseña temporal generada para <strong>${nombre}</strong>:</p>
                                    <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 15px 0;">
                                        <code style="font-size: 18px; font-weight: bold; color: #2E7D32;">${response.contrasenaTemporal}</code>
                                    </div>
                                    <p><small>¡Guarda esta contraseña! No se volverá a mostrar.</small></p>
                                `,
                                icon: 'success',
                                showConfirmButton: true,
                                confirmButtonText: 'Copiar contraseña'
                            }).then(() => {
                                // Copiar al portapapeles
                                navigator.clipboard.writeText(response.contrasenaTemporal).then(() => {
                                    showNotification('Contraseña copiada al portapapeles', 'success');
                                });
                            });
                        } else {
                            Swal.fire('Error', response.message, 'error');
                        }
                    })
                    .withFailureHandler(function(error) {
                        Swal.fire('Error', 'Error del sistema: ' + error.message, 'error');
                    })
                    .restablecerContrasena(id);
            }
        }
    });
};

window.showAddUserForm = function() {
    // Verificar permisos
    const userIsAdmin = localStorage.getItem('userIsAdmin') === 'true';
    const userRole = localStorage.getItem('userRole');
    
    if (!userIsAdmin && userRole !== 'admin') {
        showNotification('No tienes permisos para agregar usuarios', 'error');
        return;
    }
    
    // Crear formulario personalizado para SweetAlert2
    const formHTML = `
        <div class="swal2-form-group">
            <label class="swal2-label">ID o Matricula *</label>
            <input type="text" id="newUserId" class="swal2-input" placeholder="Ej: 12345678" required>
            <small>Rellena de acuerdo al sistema escolar</small>
        </div>
        <div class="swal2-form-group">
            <label class="swal2-label">Nombre Completo *</label>
            <input type="text" id="newUserName" class="swal2-input" placeholder="Ej: Juan Pérez López" required>
        </div>
        <div class="swal2-form-group">
            <label class="swal2-label">Email *</label>
            <input type="email" id="newUserEmail" class="swal2-input" placeholder="ejemplo@uabc.edu.mx" required>
        </div>
        <div class="swal2-form-group">
            <label class="swal2-label">Rol *</label>
            <select id="newUserRole" class="swal2-input" required>
                <option value="">Selecciona un rol</option>
                <option value="admin">Administrador</option>
                <option value="user">Usuario</option>
            </select>
        </div>
        <small style="color: var(--gris-texto);">* Campos obligatorios</small>
    `;
    
    Swal.fire({
        title: 'Nuevo Usuario',
        html: formHTML,
        showCancelButton: true,
        confirmButtonText: 'Crear Usuario',
        cancelButtonText: 'Cancelar',
        width: window.innerWidth <= 480 ? '95%' : '500px',
        focusConfirm: false,
        preConfirm: () => {
            const id = document.getElementById('newUserId').value.trim();
            const nombre = document.getElementById('newUserName').value.trim();
            const email = document.getElementById('newUserEmail').value.trim();
            const rol = document.getElementById('newUserRole').value;
            
            // Validaciones
            if (!id || !nombre || !email || !rol) {
                Swal.showValidationMessage('Todos los campos obligatorios deben completarse');
                return false;
            }
            
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                Swal.showValidationMessage('Ingresa un email válido');
                return false;
            }
            
            // Validar ID
            if (id.length > 50) {
                Swal.showValidationMessage('El ID no puede tener más de 50 caracteres');
                return false;
            }
            if (!/^[a-zA-Z0-9_\-\s]+$/.test(id)) {
                Swal.showValidationMessage('El ID solo puede contener letras, números, guiones, guiones bajos y espacios');
                return false;
            }
            
            return { id, nombre, email, rol };
        }
    }).then((result) => {
        if (result.isConfirmed) {
            // Llamar a la función para agregar usuario
            agregarUsuario(result.value);
        }
    });
};

window.agregarUsuario = function(userData) {
    if (typeof google === 'undefined' || typeof google.script === 'undefined') {
        // Simular agregar usuario localmente
        setTimeout(() => {
            const tempPassword = userData.nombre.substring(0, 4).toLowerCase() + "123";
            
            Swal.fire({
                title: '¡Usuario creado!',
                html: `
                    <p>Usuario creado exitosamente.</p>
                    <div style="text-align: left; margin: 20px 0;">
                        <p><strong>ID:</strong> ${userData.id}</p>
                        <p><strong>Nombre:</strong> ${userData.nombre}</p>
                        <p><strong>Email:</strong> ${userData.email}</p>
                        <p><strong>Rol:</strong> ${userData.rol}</p>
                        <p><strong>Contraseña temporal:</strong> ${tempPassword}</p>
                    </div>
                    <small>La contraseña temporal ha sido enviada al email del usuario.</small>
                `,
                icon: 'success',
                confirmButtonText: 'Aceptar'
            });
            
            // Recargar lista de usuarios
            setTimeout(() => {
                if (typeof loadUsersList === 'function') {
                    loadUsersList();
                }
            }, 1000);
        }, 1000);
    } else {
        google.script.run
            .withSuccessHandler(function(response) {
                if (response.success) {
                    Swal.fire({
                        title: '¡Usuario creado!',
                        html: `
                            <p>Usuario creado exitosamente.</p>
                            <div style="text-align: left; margin: 20px 0;">
                                <p><strong>ID:</strong> ${response.id}</p>
                                <p><strong>Nombre:</strong> ${userData.nombre}</p>
                                <p><strong>Email:</strong> ${userData.email}</p>
                                <p><strong>Rol:</strong> ${userData.rol}</p>
                                <p><strong>Contraseña temporal:</strong> ${response.contrasenaTemporal}</p>
                            </div>
                            <small>La contraseña temporal ha sido enviada al email del usuario.</small>
                        `,
                        icon: 'success',
                        confirmButtonText: 'Aceptar'
                    });
                    
                    // Recargar lista de usuarios
                    if (typeof loadUsersList === 'function') {
                        loadUsersList();
                    }
                } else {
                    Swal.fire('Error', response.message, 'error');
                }
            })
            .withFailureHandler(function(error) {
                Swal.fire('Error', 'Error del sistema: ' + error.message, 'error');
            })
            .agregarUsuario(userData);
    }
};

// También necesitamos exponer la función activateUser
window.activateUser = function(id, nombre) {
    Swal.fire({
        title: '¿Activar usuario?',
        html: `¿Activar a <strong>${nombre}</strong>?<br><br>
               <small>El usuario podrá acceder al sistema nuevamente.</small>`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#4CAF50',
        cancelButtonColor: '#757575',
        confirmButtonText: 'Sí, activar',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            if (typeof google === 'undefined' || typeof google.script === 'undefined') {
                // Simular activación local
                setTimeout(() => {
                    showNotification(`Usuario ${nombre} activado`, 'success');
                    loadUsersList();
                }, 500);
            } else {
                google.script.run
                    .withSuccessHandler(function(response) {
                        if (response.success) {
                            showNotification(`Usuario ${nombre} activado`, 'success');
                            loadUsersList();
                        } else {
                            showNotification(response.message, 'error');
                        }
                    })
                    .withFailureHandler(function(error) {
                        showNotification('Error: ' + error.message, 'error');
                    })
                    .actualizarUsuario(id, { activo: true });
            }
        }
    });
};
  </script>
</body>

</html>



